function selecionarPaciente(){$(".selecionar").on("click",function(){$("#paciente_id").val($(this).attr("paciente_id")),$("#nome_paciente").val($(this).attr("nome")).prop("readonly",!0),$("#telefone").val($(this).attr("telefone")),$("#celular").val($(this).attr("celular")),$("#dadosPaciente").show(),$("#buscaPacientes, #pacientesEncontrados").hide(),$("#salvarConsultar").show()})}function horariosDisponiveis(a,e,o){if(""!=a&&""!=e&&""!=o){$("#horarios").html(""),loadingShow("Carregando horários...");var i="";$.get($("#rota_horarios_disponiveis").val(),{data:a,medico:e,especialidade:o},function(a){$(a).each(function(a,e){i+='<div class="form-group col-md-1">',i+='<label><input type="radio" class="horario_marcado" name="horario_marcado" value="'+e+'"> '+e+"</label>",i+="</div>"}),""==i?(i+='<div class="form-group col-md-12"><strong>Agenda lotada, nesse dia!</strong></div>',$("#salvarConsultar").hide()):"N"!=$("#primeira_vez").val()&&$("#salvarConsultar").show(),$("#horarios").html(i),$("input[name='horario_marcado']").rules("add",{required:!0,messages:{required:"Marque"}}),loadingHide()},"json").fail(function(){alert("Erro ao oberter horários!")})}}$("#buscaPacientes,#pacientesEncontrados,#dadosPaciente").hide(),$("#frmMarcar").validate({debug:!1,errorClass:"error",errorElement:"p",errorPlacement:function(a,e){e.parents(".form-group").append(a);var o=$(e).next(".help-block").text();$(e).attr("aria-label",o)},highlight:function(a,e){$(a).attr("aria-invalid",!0).parents(".form-group").addClass("has-error")},unhighlight:function(a,e){$(a).removeAttr("aria-invalid").removeAttr("aria-label").parents(".form-group").removeClass("has-error")},rules:{primeira_vez:{required:!0},data_marcar:{required:!0,minlength:10},especialidade:{required:!0},medico:{required:!0},plano:{required:!0},nome_paciente:{required:!0}},messages:{primeira_vez:{required:"Selecione, por favor!"},data_marcar:{required:"Informe, por favor!",minlength:"Data incompleta!"},especialidade:{required:"Selecione, por favor!"},medico:{required:"Selecione, por favor!"},plano:{required:"Selecione, por favor!"},nome_paciente:{required:"Informe, por favor!"}}}),$("#salvarConsultar").on("click",function(){$("#frmMarcar").valid()&&(loadingShow("Marcando consulta..."),$(this).prop("disabled",!0).html("Aguarde..."),$("#frmMarcar").submit())}),$("#especialidade").on("change",function(){if($("#medico,#horarios").html(""),""!=$(this).val()){loadingShow("Carregando médicos...");var a="<option>selecione...</option>";$.get($("#rota_medico_espec").val()+"/"+$(this).val(),function(e){$(e).each(function(){a+='<option value="'+this.id+'">'+this.name+"</option>"}),$("#medico").html(a),loadingHide()},"json").fail(function(){alert("Erro ao oberter médicos da especialidades!")})}}),$("#unidade_id").on("change",function(){$("#especialidade,#medico,#horarios").html(""),loadingShow("Carregando especialidades...");var a="<option>selecione...</option>";$.get($("#rota_espec").val()+"/"+$(this).val(),function(e){$(e).each(function(){a+='<option value="'+this.id+'">'+this.nome+"</option>"}),$("#especialidade").html(a),loadingHide()},"json").fail(function(){alert("Erro ao oberter especialidades!")})}),$("#medico").on("change",function(){$("#horarios").html(""),""!=$(this).val()&&horariosDisponiveis($("#data_marcar").val(),$("#medico").val(),$("#especialidade").val())}),$("#primeira_vez").on("change",function(){$("#nome_paciente, #telefone, #celular, #paciente_id").val(""),""!=$(this).val()?"S"==$(this).val()?($("#nome_paciente").prop("readonly",!1),$("#dadosPaciente").show(),$("#localizar").val("").hide(),$("#buscaPacientes").hide(),$("#salvarConsultar").show()):($("#localizar").val(""),$("#dadosPaciente").hide(),$("#buscaPacientes").show(),$("#localizar").val("").show(),$("#salvarConsultar").hide()):$("#buscaPacientes,#pacientesEncontrados,#dadosPaciente").hide()}),$("#localizar").on("keyup",function(){$(this).val().length>0&&$("#salvarConsultar").hide(),$(this).val().length>=3?($("#pacientesEncontrados").show(),$("#encontrados").html('<tr><th colspan="5">Buscando paciente, aguarde...</th></tr>'),$.get($("#rota_paciente_busca").val(),{dadoBusca:$(this).val()},function(a){var e="<tr>";e+="<th>Nome</th>",e+="<th>CPF</th>",e+="<th>Fixo</th>",e+="<th>Celular</th>",e+="<th>Ação</th>",e+="</tr>",$(a).each(function(){e+="<tr>",e+="<td>"+this.nome+"</td>",e+="<td>"+this.cpf+"</td>",e+="<td>"+this.telefone+"</td>",e+="<td>"+this.celular+"</td>",e+='<td><a href="#" class="selecionar" title="Selecionar" data-toggle="tooltip" data-placement="bottom" paciente_id="'+this.id+'" nome="'+this.nome+'" telefone="'+this.telefone+'" celular="'+this.celular+'"><i class="fas fa-user-check"></i></a></td>',e+="</tr>"}),$("#encontrados").html(e),$('[data-toggle="tooltip"]').tooltip(),selecionarPaciente(),loadingHide()},"json").fail(function(){alert("Erro ao localizar paciente!")})):$("#pacientesEncontrados").hide()}),$(".dataConsulta").mask("00/00/0000"),$(".telefone").mask("(00) 0000-0000"),$(".celular").mask("(00) 00000-0000"),$(".dataConsulta").datepicker({format:"dd/mm/yyyy",autoclose:"true",language:"pt-BR",weekStart:0,startDate:"0d",todayHighlight:!0}).on("changeDate",function(a){horariosDisponiveis($(this).val(),$("#medico").val(),$("#especialidade").val())}),$("#data_marcar").on("keyup",function(){""!=$(this).val()&&10==$(this).val().length?horariosDisponiveis($(this).val(),$("#medico").val(),$("#especialidade").val()):$("#horarios").html("")});