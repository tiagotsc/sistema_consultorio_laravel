function verificaAgenda(a,t,e,i){0!=e.length&&($(".agenda-todos").css({color:"black","text-decoration":"none","font-weight":"normal"}).removeClass("pisca_pisca"),$(".editar,.apagar").show(),$.each(e,function(){moment().isAfter(moment().format("YYYY-MM-DD "+$(this).html()))&&"Presente"==$(this).attr("status")&&$(".agenda-dados"+$(this).attr("id")).css("color","red"),moment().isAfter(moment().format("YYYY-MM-DD "+$(this).html()))&&"Marcado"==$(this).attr("status")&&$(".agenda-dados"+$(this).attr("id")).css("color","gray"),"Chamado"==$(this).attr("status")&&$(".agenda-dados"+$(this).attr("id")).css("font-weight","bold").addClass("pisca_pisca"),"Desistiu"!=$(this).attr("status")&&"Finalizado"!=$(this).attr("status")||$(".agenda-dados"+$(this).attr("id")).css("text-decoration","line-through"),"Em atendimento"==$(this).attr("status")&&($(".agenda-dados"+$(this).attr("id")).css("color","Navy"),$("a[idEdit='"+$(this).attr("id")+"']").hide(),$("a[idDel='"+$(this).attr("id")+"']").hide())}))}function getAgendamentosUnidade(){$.get($("#rota-agendamentos").val()+"/"+$("#unidade").val(),function(a){$(".responsive-calendar").responsiveCalendar("clearAll"),$(".responsive-calendar").responsiveCalendar("edit",a)},"json").fail(function(){alert("erro na unidade")})}function dump(a){var t="";for(var e in a)t+=e+": "+a[e]+"\n";alert(t)}var todasSequencias=JSON.parse($("#todas_sequencias").val()),table;table=$("#frm-pesq").DataTable({language:{url:"/js/datatable/language/dataTables.pt-br.json",select:{rows:{_:"Você selecionou %d linhas",0:"Clique na linha para selecionar",1:"Apenas 1 linha foi selecionada"}},buttons:{copyTitle:"Tabela copiada",copySuccess:{_:"%d linhas copiadas",1:"1 linha copiada"}}},pageLength:50,drawCallback:function(a){$('[data-toggle="tooltip"]').tooltip()},ajax:{url:$("#rota_pesquisa_consulta").val(),type:"GET",data:function(a){a._token=$("input[name='_token']").val(),a.input_dado=$("#input_dado").val(),a.horario=$("#horario").val(),a.unidade=$("#unidade").val(),a.data=$("input[name='data']").val()}},processing:!0,columnDefs:[{targets:0,data:"horario",render:function(a,t,e){return'<span class="agenda-hora agenda-dados'+e.id+' agenda-todos" id="'+e.id+'" status="'+e.status+'">'+a+"</span>"},className:"dt-body-center"},{targets:1,data:"nome",render:function(a,t,e){return'<span class="agenda-dados'+e.id+' agenda-todos" id="'+e.id+'">Paciente: '+a+"<br>Doutor(a): "+e.medico+"<br>Especialidade: "+e.especialidade+"</span>"},className:"dt-body-left"},{targets:2,data:"status",render:function(a,t,e){return'<a href="#" class="status" agenda_id="'+e.id+'" status_id="'+e.status_id+'" horario="'+e.horario+'" paciente="'+e.nome+'" medico_id="'+e.medico_id+'">'+a+"</a>"},className:"dt-body-center"},{targets:3,data:"id",orderable:!1,render:function(a,t,e){if("display"===t){var i='<span id="botoes_id'+a+'">';if("Medico"==$("#user_type").val()&&"Presente"==e.status&&(i+='<a title="Chamar paciente" data-toggle="tooltip" data-placement="bottom" href="#" id="'+a+'" horario="'+e.horario+'" paciente="'+e.nome+'" class="chamar chamarId'+a+' marginIcon"><i class="fas fa-assistive-listening-systems"></i></a>'),"Medico"==$("#user_type").val()&&("Chamado"==e.status||"Em atendimento"==e.status||"Finalizado"==e.status)){var s="Finalizado"==e.status?'<i class="fas fa-search fa-lg"></i>':'<i class="fas fa-sign-in-alt fa-lg"></i>';i+='<a title="Atender paciente" data-toggle="tooltip" data-placement="bottom" href="'+$("#rota_atende").val().replace("0",a)+'" class="atenderId'+a+' marginIcon">'+s+"</a>"}if($("#all_permissions").val().indexOf("paciente-editar")>-1&&"S"==e.novo){i+='<a title="Ficha incompleta" data-toggle="tooltip" data-placement="bottom" href="'+$("#rota-paciente-editar").val().replace("0",e.paciente_id)+'" class="marginIcon"><i class="fas fa-address-book fa-lg"></i></a>'}return $("#all_permissions").val().indexOf("paciente-editar")>-1&&(i+='<a data-toggle="modal" data-target="#modalDefault" href="#" idEdit="'+a+'" class="editar marginIcon"><i title="Editar consulta" data-toggle="tooltip" data-placement="bottom" class="fas fa-edit fa-lg"></i></a>'),$("#all_permissions").val().indexOf("paciente-apagar")>-1&&(i+='<a idDel="'+a+'" titulo="'+e.nome+'" href="#" data-toggle="modal" data-target="#modalApagar" class="apagar"><i title="Apagar" data-toggle="tooltip" data-placement="bottom" class="fas fa-trash-alt fa-lg"></a>'),i+="</span>"}return a},className:"dt-body-center"}]}),$("#pesq").on("click",function(){table.clear().draw(),table.ajax.reload()}),$("#frm-pesq tbody").on("click",".editar",function(a){a.preventDefault(),montaModalDefault($("#rota_edita_consulta").val().replace("0",$(this).attr("idEdit")),"")}),$("#frm-pesq tbody").on("click",".apagar",function(a){a.preventDefault(),$("#frm-deletar").attr("action",$("#rota-deletar").val().replace(0,$(this).attr("idDel"))),$("#del-id").val($(this).attr("idDel")),$("#del-nome").val($(this).attr("titulo"))}),$("#frm-pesq tbody").on("click",".chamar",function(a){a.preventDefault();var t=$("#rota_altera_status").val().replace("0",$(this).attr("id"));$("#frmAlteraStatus").attr("action",t);$("#agenda_status_id").html('<option value="4" selected>Chamado</option>'),$("#altera_status_paciente").val($(this).attr("paciente")),$("#altera_status_horario").val($(this).attr("horario")),$("#altera_status_medico_id").val($("#user_id").val()),$("#frmAlteraStatus").submit()}),$("#modalMarcar").on("click",function(a){a.preventDefault(),montaModalDefault($("#rota_cadastra_consulta").val(),$(this).attr("data-selecionada"))}),$("#frm-pesq tbody").on("click",".status",function(a){a.preventDefault();var t=$("#rota_altera_status").val().replace("0",$(this).attr("agenda_id"));$("#frmAlteraStatus").attr("action",t);var e=$(this).attr("status_id"),i="";$.each(todasSequencias[e],function(a,t){var s=a.replace("_","");i+='<option value="'+s+'" '+(e==s?"selected":"")+">"+t+"</option>"}),$("#agenda_status_id").html(i),$("#altera_status_paciente").val($(this).attr("paciente")),$("#altera_status_horario").val($(this).attr("horario")),$("#altera_status_medico_id").val($(this).attr("medico_id")),$("#modalStatus").modal("show")}),$("#bt-status-altera").on("click",function(){$(this).prop("disabled",!0).html("Aguarde..."),$("#frmAlteraStatus").submit()});var dataSel=$("input[name='data']").val(),dataAtual=moment().format("DD/MM/YYYY");dataSel==dataAtual&&self.setInterval(function(){verificaAgenda(dataSel,dataAtual,$(".agenda-hora"),$(".agenda-dados"))},1e3);var setCanal="Medico"==$("#user_type").val()?$("#user_type").val()+"."+$("#user_id").val():"",channel=pusher.subscribe("agendaStatus"+setCanal);channel.bind("App\\Events\\AgendaStatusEvento",function(a){if(moment().format("DD/MM/YYYY")==a.agenda.data&&$("#unidade").val()==a.agenda.unidade_id){if($(".agenda-dados"+a.agenda.id).attr("status",a.agenda.status_nome),$('a[agenda_id="'+a.agenda.id+'"]').attr("status_id",a.agenda.status_id).html(a.agenda.status_nome),$(".chamarId"+a.agenda.id).remove(),$(".atenderId"+a.agenda.id).remove(),a.medicoId==$("#user_id").val()){if("Medico"==$("#user_type").val()&&"Presente"==a.agenda.status_nome&&$("#botoes_id"+a.agenda.id).prepend('<a title="Chamar paciente" data-toggle="tooltip" data-placement="bottom" href="#" id="'+a.agenda.id+'" horario="'+a.agenda.horario+'" paciente="'+a.agenda.paciente+'" class="chamar chamarId'+a.agenda.id+' marginIcon"><i class="fas fa-assistive-listening-systems"></i></a>'),"Medico"==$("#user_type").val()&&"Em atendimento"==a.agenda.status_nome){var t=$("#rota_atende").val().replace("0",a.agenda.id);$("#botoes_id"+a.agenda.id).prepend('<a title="Atender paciente" data-toggle="tooltip" data-placement="bottom" href="'+t+'" class="marginIcon atenderId'+a.agenda.id+'"><i class="fas fa-sign-in-alt fa-lg"></i></a>')}$.notify("Dr(a): O paciente "+a.agenda.paciente+" marcado às "+a.agenda.horario+" mudou para "+a.agenda.status_nome+".","info")}"Secretaria"==$("#user_type").val()&&4==a.agenda.status_id&&$.notify("O paciente "+a.agenda.paciente+" marcado às "+a.agenda.horario+" esta sendo chamado.","info"),$('[data-toggle="tooltip"]').tooltip()}}),$("#unidade").on("change",function(){getAgendamentosUnidade()}),getAgendamentosUnidade();